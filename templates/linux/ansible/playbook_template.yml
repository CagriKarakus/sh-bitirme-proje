---
# Ansible Playbook Template for Linux Security Hardening
# Auto-generated from CIS Benchmark rules

- name: CIS Benchmark Security Hardening
  hosts: all
  become: yes
  gather_facts: yes

  vars:
    # Control variables
    cis_apply_remediation: true  # Set to false for audit-only mode
    cis_generate_report: true
    cis_report_path: "/tmp/cis_report_{{ ansible_date_time.epoch }}"

    # Platform detection
    detected_platform: "{{ ansible_system | lower }}"
    detected_distribution: "{{ ansible_distribution | lower }}"
    detected_version: "{{ ansible_distribution_version }}"

  tasks:
    - name: Display detected platform
      debug:
        msg: |
          Platform: {{ detected_platform }}
          Distribution: {{ detected_distribution }}
          Version: {{ detected_version }}

    # Rule tasks will be inserted here by compose_ansible.py
    # Each rule will have an audit task and optional remediation task

    - name: Generate audit report
      when: cis_generate_report
      block:
        - name: Create report directory
          file:
            path: "{{ cis_report_path }}"
            state: directory
            mode: '0755'

        - name: Generate HTML report
          template:
            src: report_template.html.j2
            dest: "{{ cis_report_path }}/cis_report.html"
          when: false  # Disabled for now, implement report generation

  handlers:
    - name: reload systemd
      systemd:
        daemon_reload: yes
