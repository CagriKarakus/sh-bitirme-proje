{
    "rule_id": "1.1.7",
    "title": "Ensure 'Store passwords using reversible encryption' is set to 'Disabled'",
    "description": "This policy setting determines whether the operating system stores passwords in a way that uses reversible encryption, which provides support for application protocols that require knowledge of the user's password for authentication purposes. Passwords that are stored with reversible encryption are essentially the same as plaintext versions of the passwords. The recommended state for this setting is: Disabled.",
    "cis_level": 1,
    "category": "Account Policies",
    "subcategory": "Password Policy",
    "applies_to": [
        "Windows 11",
        "Windows 10",
        "Windows Server 2022",
        "Windows Server 2019",
        "Windows Server 2016"
    ],
    "automated": true,
    "registry_config": null,
    "gpo_config": {
        "policy_path": "Computer Configuration\\Policies\\Windows Settings\\Security Settings\\Account Policies\\Password Policy",
        "setting_name": "Store passwords using reversible encryption",
        "setting_value": 0,
        "admx_category": "PasswordPolicy"
    },
    "implementation_local": {
        "powershell_command": null,
        "powershell_script": "$seceditExport = \"$env:TEMP\\secpol_export.cfg\"\n$seceditImport = \"$env:TEMP\\secpol_import.cfg\"\nsecedit /export /cfg $seceditExport /quiet\n$content = Get-Content $seceditExport\n$content = $content -replace 'ClearTextPassword\\s*=\\s*\\d+', 'ClearTextPassword = 0'\nif ($content -notmatch 'ClearTextPassword') {\n    $content = $content -replace '(\\[System Access\\])', \"`$1`nClearTextPassword = 0\"\n}\n$content | Set-Content $seceditImport -Force\nsecedit /configure /db secedit.sdb /cfg $seceditImport /quiet\nRemove-Item $seceditExport, $seceditImport -Force -ErrorAction SilentlyContinue",
        "requires_admin": true,
        "requires_reboot": false
    },
    "implementation_gpo": {
        "inf_section": "[System Access]",
        "inf_key": "ClearTextPassword",
        "inf_value": "0"
    },
    "audit_logic": {
        "powershell_script": "try {\n    $tempFile = \"$env:TEMP\\secpol_audit_$([guid]::NewGuid().ToString('N')).cfg\"\n    secedit /export /cfg $tempFile /quiet 2>&1 | Out-Null\n    if (Test-Path $tempFile) {\n        $content = Get-Content $tempFile -Raw\n        Remove-Item $tempFile -Force -ErrorAction SilentlyContinue\n        if ($content -match 'ClearTextPassword\\s*=\\s*(\\d+)') {\n            return ([int]$Matches[1] -eq 0)\n        }\n        # If not explicitly set, default is 0 (Disabled)\n        return $true\n    }\n    return $false\n} catch {\n    return $false\n}",
        "expected_result": true
    },
    "remediation_rollback": {
        "powershell_command": null,
        "original_value": 0,
        "description": "Default value is already Disabled (0). No rollback needed as this is the secure default."
    },
    "impact": {
        "severity": "low",
        "description": "If your organization uses either the CHAP authentication protocol through remote access or IAS services or Digest Authentication in IIS, you must configure this policy setting to Enabled. This is extremely dangerous to apply through Group Policy on a user-by-user basis."
    },
    "rationale": "Enabling this policy setting allows the operating system to store passwords in a weaker format that is much more susceptible to compromise and weakens your system security.",
    "default_value": {
        "standalone": 0,
        "domain_joined": 0
    },
    "references": [
        "https://www.cisecurity.org/white-papers/cis-password-policy-guide/",
        "https://learn.microsoft.com/en-us/windows/security/threat-protection/security-policy-settings/password-policy"
    ],
    "tags": [
        "password",
        "account-policy",
        "authentication",
        "level-1",
        "automated",
        "encryption",
        "security"
    ]
}