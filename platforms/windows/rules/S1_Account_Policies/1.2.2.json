{
    "rule_id": "1.2.2",
    "title": "Ensure 'Account lockout threshold' is set to '5 or fewer invalid logon attempt(s), but not 0'",
    "description": "This account lockout policy setting determines the number of failed sign-in attempts that will cause a user account to be locked. A locked account cannot be used until you reset it or until the number of minutes specified by the Account lockout duration policy setting expires. You can set a value from 1 through 999 failed sign-in attempts, or you can specify that the account will never be locked by setting the value to 0. If Account lockout threshold is set to a number greater than zero, Account lockout duration must be greater than or equal to the value of Reset account lockout counter after.",
    "cis_level": 1,
    "category": "Account Policies",
    "subcategory": "Account Lockout Policy",
    "applies_to": [
        "Windows 11",
        "Windows 10",
        "Windows Server 2022",
        "Windows Server 2019",
        "Windows Server 2016"
    ],
    "automated": true,
    "registry_config": null,
    "gpo_config": {
        "policy_path": "Computer Configuration\\Policies\\Windows Settings\\Security Settings\\Account Policies\\Account Lockout Policy",
        "setting_name": "Account lockout threshold",
        "setting_value": "5",
        "admx_category": "AccountLockout"
    },
    "implementation_local": {
        "powershell_command": null,
        "powershell_script": "$seceditExport = \"$env:TEMP\\secpol_export.cfg\"\n$seceditImport = \"$env:TEMP\\secpol_import.cfg\"\nsecedit /export /cfg $seceditExport /quiet\n$content = Get-Content $seceditExport\n$content = $content -replace 'LockoutBadCount\\s*=\\s*\\d+', 'LockoutBadCount = 5'\nif ($content -notmatch 'LockoutBadCount') {\n    $content = $content -replace '(\\[System Access\\])', \"`$1`nLockoutBadCount = 5\"\n}\n$content | Set-Content $seceditImport -Force\nsecedit /configure /db secedit.sdb /cfg $seceditImport /quiet\nRemove-Item $seceditExport, $seceditImport -Force -ErrorAction SilentlyContinue",
        "requires_admin": true,
        "requires_reboot": false
    },
    "implementation_gpo": {
        "inf_section": "[System Access]",
        "inf_key": "LockoutBadCount",
        "inf_value": "5"
    },
    "audit_logic": {
        "powershell_script": "try {\n    $tempFile = \"$env:TEMP\\secpol_audit_$([guid]::NewGuid().ToString('N')).cfg\"\n    secedit /export /cfg $tempFile /quiet 2>&1 | Out-Null\n    if (Test-Path $tempFile) {\n        $content = Get-Content $tempFile -Raw\n        Remove-Item $tempFile -Force -ErrorAction SilentlyContinue\n        if ($content -match 'LockoutBadCount\\s*=\\s*(\\d+)') {\n            $val = [int]$Matches[1]\n            return ($val -le 5 -and $val -gt 0)\n        }\n    }\n    return $false\n} catch {\n    return $false\n}",
        "expected_result": true
    },
    "remediation_rollback": {
        "powershell_command": "$seceditExport = \"$env:TEMP\\secpol_export.cfg\"; $seceditImport = \"$env:TEMP\\secpol_import.cfg\"; secedit /export /cfg $seceditExport /quiet; $content = Get-Content $seceditExport; $content = $content -replace 'LockoutBadCount\\s*=\\s*\\d+', 'LockoutBadCount = 0'; $content | Set-Content $seceditImport -Force; secedit /configure /db secedit.sdb /cfg $seceditImport /quiet",
        "original_value": 0,
        "description": "Sets Account lockout threshold to 0 (Account will not lock out)"
    },
    "impact": {
        "severity": "medium",
        "description": "If the account lockout threshold is set to 0, the account will not be locked out regardless of how many failed attempts are made."
    },
    "rationale": "Account lockout is a useful method for slowing down online password guessing attacks (brute force attacks).",
    "default_value": {
        "standalone": 0,
        "domain_joined": 0
    },
    "references": [
        "https://www.cisecurity.org/benchmark/microsoft_windows_desktop/"
    ],
    "tags": [
        "account-policy",
        "lockout-policy",
        "security",
        "cis",
        "level-1"
    ]
}