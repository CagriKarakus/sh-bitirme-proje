{
    "rule_id": "1.1.2",
    "title": "Ensure 'Maximum password age' is set to '365 or fewer days, but not 0'",
    "description": "This policy setting defines how long a user can use their password before it expires. Values for this policy setting range from 0 to 999 days. If you set the value to 0, the password will never expire. Because attackers can crack passwords, the more frequently you change the password the less opportunity an attacker has to use a cracked password. The recommended state for this setting is 365 or fewer days, but not 0.",
    "cis_level": 1,
    "category": "Account Policies",
    "subcategory": "Password Policy",
    "applies_to": [
        "Windows 11",
        "Windows 10",
        "Windows Server 2022",
        "Windows Server 2019",
        "Windows Server 2016"
    ],
    "automated": true,
    "registry_config": null,
    "gpo_config": {
        "policy_path": "Computer Configuration\\Policies\\Windows Settings\\Security Settings\\Account Policies\\Password Policy",
        "setting_name": "Maximum password age",
        "setting_value": 365,
        "admx_category": "PasswordPolicy"
    },
    "implementation_local": {
        "powershell_command": "net accounts /maxpwage:365",
        "powershell_script": "$seceditExport = \"$env:TEMP\\secpol_export.cfg\"\n$seceditImport = \"$env:TEMP\\secpol_import.cfg\"\nsecedit /export /cfg $seceditExport /quiet\n$content = Get-Content $seceditExport\n$content = $content -replace 'MaximumPasswordAge\\s*=\\s*\\d+', 'MaximumPasswordAge = 365'\nif ($content -notmatch 'MaximumPasswordAge') {\n    $content = $content -replace '(\\[System Access\\])', \"`$1`nMaximumPasswordAge = 365\"\n}\n$content | Set-Content $seceditImport -Force\nsecedit /configure /db secedit.sdb /cfg $seceditImport /quiet\nRemove-Item $seceditExport, $seceditImport -Force -ErrorAction SilentlyContinue",
        "requires_admin": true,
        "requires_reboot": false
    },
    "implementation_gpo": {
        "inf_section": "[System Access]",
        "inf_key": "MaximumPasswordAge",
        "inf_value": "365"
    },
    "audit_logic": {
        "powershell_script": "try {\n    $output = net accounts 2>&1\n    $maxAgeLine = $output | Select-String 'Maximum password age'\n    if ($maxAgeLine) {\n        $valueStr = ($maxAgeLine -replace '.*:\\s*', '').Trim()\n        if ($valueStr -match 'Unlimited' -or $valueStr -eq '0') {\n            return $false\n        }\n        $value = [int]($valueStr -replace '[^0-9]', '')\n        return ($value -ge 1 -and $value -le 365)\n    }\n    return $false\n} catch {\n    return $false\n}",
        "expected_result": true
    },
    "remediation_rollback": {
        "powershell_command": "net accounts /maxpwage:42",
        "original_value": 42,
        "description": "Restores to Windows default of 42 days"
    },
    "impact": {
        "severity": "low",
        "description": "If the Maximum password age setting is too low, users are required to change their passwords very often. Such a configuration can reduce security in the organization, because users might write their passwords in an insecure location or lose them."
    },
    "rationale": "The longer a password exists the higher the likelihood that it will be compromised by a brute force attack, by an attacker gaining general knowledge about the user, or by the user sharing the password. Configuring the Maximum password age setting to 0 so that users are never required to change their passwords is a major security risk.",
    "default_value": {
        "standalone": 42,
        "domain_joined": 42
    },
    "references": [
        "https://www.cisecurity.org/white-papers/cis-password-policy-guide/",
        "https://learn.microsoft.com/en-us/windows/security/threat-protection/security-policy-settings/password-policy"
    ],
    "tags": [
        "password",
        "account-policy",
        "authentication",
        "level-1",
        "automated",
        "password-age"
    ]
}