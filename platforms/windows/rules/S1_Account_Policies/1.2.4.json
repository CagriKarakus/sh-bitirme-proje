{
    "rule_id": "1.2.4",
    "title": "Ensure 'Reset account lockout counter after' is set to '15 or more minute(s)'",
    "description": "This policy setting determines the number of minutes that must elapse after a failed logon attempt before the failed logon attempt counter is reset to 0 failed logon attempts. The available range is 1 minute to 99,999 minutes. If Account lockout threshold is set to a number greater than zero, this reset time must be less than or equal to the Account lockout duration.",
    "cis_level": 1,
    "category": "Account Policies",
    "subcategory": "Account Lockout Policy",
    "applies_to": [
        "Windows 11",
        "Windows 10",
        "Windows Server 2022",
        "Windows Server 2019",
        "Windows Server 2016"
    ],
    "automated": true,
    "registry_config": null,
    "gpo_config": {
        "policy_path": "Computer Configuration\\Policies\\Windows Settings\\Security Settings\\Account Policies\\Account Lockout Policy",
        "setting_name": "Reset account lockout counter after",
        "setting_value": "15 or more minute(s)",
        "admx_category": "AccountLockout"
    },
    "implementation_local": {
        "powershell_command": null,
        "powershell_script": "$seceditExport = \"$env:TEMP\\secpol_export.cfg\"\n$seceditImport = \"$env:TEMP\\secpol_import.cfg\"\nsecedit /export /cfg $seceditExport /quiet\n$content = Get-Content $seceditExport\n$content = $content -replace 'ResetLockoutCount\\s*=\\s*\\d+', 'ResetLockoutCount = 15'\nif ($content -notmatch 'ResetLockoutCount') {\n    $content = $content -replace '(\\[System Access\\])', \"`$1`nResetLockoutCount = 15\"\n}\n$content | Set-Content $seceditImport -Force\nsecedit /configure /db secedit.sdb /cfg $seceditImport /quiet\nRemove-Item $seceditExport, $seceditImport -Force -ErrorAction SilentlyContinue",
        "requires_admin": true,
        "requires_reboot": false
    },
    "implementation_gpo": {
        "inf_section": "[System Access]",
        "inf_key": "ResetLockoutCount",
        "inf_value": "15"
    },
    "audit_logic": {
        "powershell_script": "try {\n    $tempFile = \"$env:TEMP\\secpol_audit_$([guid]::NewGuid().ToString('N')).cfg\"\n    secedit /export /cfg $tempFile /quiet 2>&1 | Out-Null\n    if (Test-Path $tempFile) {\n        $content = Get-Content $tempFile -Raw\n        Remove-Item $tempFile -Force -ErrorAction SilentlyContinue\n        if ($content -match 'ResetLockoutCount\\s*=\\s*(\\d+)') {\n            $val = [int]$Matches[1]\n            return ($val -ge 15)\n        }\n    }\n    return $false\n} catch {\n    return $false\n}",
        "expected_result": true
    },
    "remediation_rollback": {
        "powershell_command": "$seceditExport = \"$env:TEMP\\secpol_export.cfg\"; $seceditImport = \"$env:TEMP\\secpol_import.cfg\"; secedit /export /cfg $seceditExport /quiet; $content = Get-Content $seceditExport; $content = $content -replace 'ResetLockoutCount\\s*=\\s*\\d+', 'ResetLockoutCount = 0'; $content | Set-Content $seceditImport -Force; secedit /configure /db secedit.sdb /cfg $seceditImport /quiet",
        "original_value": 0,
        "description": "Sets Reset account lockout counter to 0 (default)"
    },
    "impact": {
        "severity": "medium",
        "description": "Users who accidentally lock themselves out will have to wait for the specified duration before they can try again."
    },
    "rationale": "This setting helps to prevent a brute force attack on a user account by resetting the bad password count after a specified period of time.",
    "default_value": {
        "standalone": 0,
        "domain_joined": 0
    },
    "references": [
        "https://www.cisecurity.org/benchmark/microsoft_windows_desktop/"
    ],
    "tags": [
        "account-policy",
        "lockout-policy",
        "security",
        "cis",
        "level-1"
    ]
}