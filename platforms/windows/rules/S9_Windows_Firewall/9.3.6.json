{
    "rule_id": "9.3.6",
    "title": "Ensure 'Windows Firewall: Public: Logging: Name is set to %SystemRoot%\\System32\\logfiles\\firewall\\publicfw.log'",
    "description": "This policy setting controls Windows Defender Firewall parameters.",
    "cis_level": 1,
    "category": "Windows Firewall",
    "applies_to": [
        "Windows 11",
        "Windows 10",
        "Windows Server 2022",
        "Windows Server 2019",
        "Windows Server 2016"
    ],
    "automated": true,
    "registry_config": {
        "path": "HKLM:\\SOFTWARE\\Policies\\Microsoft\\WindowsFirewall\\PublicProfile\\Logging",
        "value_name": "LogFilePath",
        "value_type": "REG_EXPAND_SZ",
        "value_data": "%SystemRoot%\\System32\\logfiles\\firewall\\publicfw.log",
        "comparison": "equals"
    },
    "gpo_config": {
        "policy_path": "Computer Configuration\\Policies\\Windows Settings\\Security Settings\\Windows Defender Firewall with Advanced Security\\Windows Defender Firewall with Advanced Security",
        "setting_name": "Windows Firewall: Public: Logging: Name is set to %SystemRoot%\\System32\\logfiles\\firewall\\publicfw.log",
        "setting_value": "",
        "admx_category": "WindowsFirewall"
    },
    "implementation_local": {
        "powershell_command": "",
        "powershell_script": "if (-not (Test-Path 'HKLM:\\SOFTWARE\\Policies\\Microsoft\\WindowsFirewall\\PublicProfile\\Logging')) { New-Item -Path 'HKLM:\\SOFTWARE\\Policies\\Microsoft\\WindowsFirewall\\PublicProfile\\Logging' -Force }; Set-ItemProperty -Path 'HKLM:\\SOFTWARE\\Policies\\Microsoft\\WindowsFirewall\\PublicProfile\\Logging' -Name 'LogFilePath' -Value '%SystemRoot%\\System32\\logfiles\\firewall\\publicfw.log' -Type ExpandString -Force",
        "requires_admin": true,
        "requires_reboot": false
    },
    "implementation_gpo": {
        "inf_section": "[Registry Values]",
        "inf_key": "MACHINE\\SOFTWARE\\Policies\\Microsoft\\WindowsFirewall\\PublicProfile\\Logging\\LogFilePath",
        "inf_value": "2,\"%SystemRoot%\\System32\\logfiles\\firewall\\publicfw.log\"",
        "gpo_xml": "<RegistryValue name='LogFilePath' type='REG_EXPAND_SZ' value='%SystemRoot%\\System32\\logfiles\\firewall\\publicfw.log'/>"
    },
    "audit_logic": {
        "powershell_script": "$val = (Get-ItemProperty -Path 'HKLM:\\SOFTWARE\\Policies\\Microsoft\\WindowsFirewall\\PublicProfile\\Logging' -Name 'LogFilePath' -ErrorAction SilentlyContinue).'LogFilePath'; return ($val -eq '%SystemRoot%\\System32\\logfiles\\firewall\\publicfw.log')",
        "expected_result": true
    },
    "remediation_rollback": {
        "powershell_command": "Remove-ItemProperty -Path 'HKLM:\\SOFTWARE\\Policies\\Microsoft\\WindowsFirewall\\PublicProfile\\Logging' -Name 'LogFilePath' -Force"
    },
    "impact": {
        "severity": "medium",
        "description": "Changes to firewall profiles affect inbound and outbound connectivity. Test changes before applying to production."
    },
    "rationale": "Windows Defender Firewall helps prevent unauthorized access to the network and protects against malware.",
    "default_value": {
        "standalone": "Varies",
        "domain_joined": "Varies"
    },
    "references": [
        "https://www.cisecurity.org/benchmark/microsoft_windows_desktop/"
    ],
    "tags": [
        "windows-firewall",
        "cis",
        "security"
    ]
}